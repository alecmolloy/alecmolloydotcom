var gameOfLife=function(e){this.ctx=e.ctx,this.canvas=e.canvas,this.colour=e.colour||"#444",this.speed=e.speed||1e3,this.width=Math.ceil(window.innerWidth*devicePixelRatio),this.height=Math.ceil(window.innerHeight*devicePixelRatio),this.cellSize=e.cellSize?e.cellSize*devicePixelRatio:20*devicePixelRatio,this.boardHeight=e.board?e.board.length:Math.ceil(this.height/this.cellSize),this.boardWidth=e.board?e.board[0].length:Math.ceil(this.width/this.cellSize),this.currentBoard=this.generateBoard(e.board),this.nextBoard=this.generateEmptyBoard,this.animate();var t=gameOfLife.addPentomino.bind(this);document.addEventListener("click",t)};gameOfLife.prototype.generateBoard=function(e){for(var t=this.generateEmptyBoard(),i=0;i<this.boardHeight;i++)for(var r=0;r<this.boardWidth;r++)t[i][r]=new gameOfLife.Cell(e?{x:r,y:i,state:e[i][r]}:{x:r,y:i,state:Math.round(Math.random()/1.5)});return t},gameOfLife.prototype.generateEmptyBoard=function(){for(var e=new Array(this.boardWidth),t=0;t<this.boardHeight;t++)e[t]=new Array(this.boardHeight);return e},gameOfLife.prototype.renderBoard=function(){this.ctx.clearRect(0,0,this.width,this.height);for(var e=0;e<this.boardHeight;e++)for(var t=0;t<this.boardWidth;t++)1===this.currentBoard[e][t].state&&(this.ctx.fillStyle=this.colour,this.ctx.fillRect(t*this.cellSize,e*this.cellSize,this.cellSize,this.cellSize))},gameOfLife.prototype.generation=function(){this.nextBoard=this.generateEmptyBoard();for(var e=0;e<this.boardHeight;e++)for(var t=0;t<this.boardWidth;t++){var i=this.yayOrNay(this.currentBoard[e][t]);this.nextBoard[e][t]=new gameOfLife.Cell({x:t,y:e,state:i})}this.currentBoard=this.nextBoard.slice()},gameOfLife.prototype.findNeighbours=function(e){for(var t=0,i=-1;1>=i;i++)for(var r=-1;1>=r;r++)if(0!==r||0!==i){var a=r+e.x,o=i+e.y;0>a&&(a=this.boardWidth-1),a>=this.boardWidth&&(a=0),0>o&&(o=this.boardHeight-1),o>=this.boardHeight&&(o=0);var h=this.currentBoard[o][a];1===h.state&&t++}return t},gameOfLife.prototype.yayOrNay=function(e){{var a,t=this.findNeighbours(e);e.x,e.y}return 0===e.state?3===t?a=1:3!==t&&(a=0):1===e.state&&(2>t||t>3?a=0:(2===t||3===t)&&(a=1)),a},gameOfLife.prototype.animate=function(){this.renderBoard(),this.generation();var t=this.animate.bind(this);"max"===this.speed?window.requestAnimationFrame(t):window.setTimeout(t,this.speed)},gameOfLife.addPentomino=function(e){for(var t=Math.floor(e.x*devicePixelRatio/this.cellSize),i=Math.floor(e.y*devicePixelRatio/this.cellSize),r=[[0,1,1],[1,1,0],[0,1,0],[0,1,0]],a=-1;1>=a;a++)for(var o=-1;1>=o;o++){var h=t+o,s=i+a;0>h&&(h=this.boardWidth-1),h>=this.boardWidth&&(h=0),0>s&&(s=this.boardHeight-1),s>=this.boardHeight&&(s=0),this.currentBoard[s][h].state=r[a+1][o+1]}this.renderBoard()},gameOfLife.Cell=function(e){this.x=e.x,this.y=e.y,this.state=e.state};
